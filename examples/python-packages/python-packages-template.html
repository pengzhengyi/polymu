<!DOCTYPE html>
<html>
  <head>
    <title>Simple index</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
      crossorigin="anonymous"
    />
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <template id="template-python-packages">
      <!-- DATA -->
    </template>
    <div class="d-flex flex-column justify-content-center align-items-center h-100">
      <div class="input-group w-50 mb-2">
        <input
          id="filter-query"
          type="search"
          class="form-control"
          placeholder="Search Python packages"
          aria-label="python package search input"
          aria-describedby="filter-packages"
        />
        <button class="btn btn-primary text-white" type="button" id="filter-packages">
          Search
        </button>
      </div>

      <div class="overflow-auto w-50" style="height: 80vh">
        <ol id="target" class="list-group"></ol>
      </div>
    </div>

    <script src="../../dist/polymu.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
      crossorigin="anonymous"
    ></script>
    <script>
      const target = document.getElementById('target');
      const source = document.getElementById('template-python-packages');

      const view = new polymu.BaseView(
        source,
        target,
        [
          new polymu.FilteredView(),
          new polymu.SortedView(),
          new polymu.ViewTransformation((element) => {
            element.classList.add('list-group-item');
            const url = element.href;
            const projectName = url.substring(
              url.lastIndexOf('/', url.length - 2) + 1,
              url.length - 1
            );
            element.href = `https://pypi.org/project/${projectName}/`;
            return element;
          }),
        ],
        polymu.BaseView.SCROLL_VIEW_FACTORY
      );
      view.setWindow(0, 100);

      const filterInput = document.getElementById('filter-query');

      function filterPackages(query) {
        view.addFilterFunction('filter', (element) => element.textContent.includes(query));
      }

      function getFilterQuery() {
        return filterInput.value;
      }

      filterInput.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
          filterPackages(getFilterQuery());
        }
      });

      filterInput.addEventListener(
        'keyup',
        polymu.debounceWithCooldown((event) => {
          filterPackages(getFilterQuery());
        }),
        100
      );

      const filterPackagesButton = document.getElementById('filter-packages');
      filterPackagesButton.addEventListener('click', () => filterPackages(getFilterQuery()));
    </script>
  </body>
</html>
